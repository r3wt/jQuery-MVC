/**
 * jqMVC - The jQuery MVC Framework
 *
 * @version   0.6.0
 * @link      https://github.com/r3wt/jqMVC
 * @copyright (c) 2015 Garrett R. Morris
 * @license   https://github.com/r3wt/jqMVC/blob/master/LICENSE (MIT License)
 * @build     2016-03-23_01:14:48 UTC
 */
!function($,window,document){function isDefined(e){return typeof e!="undefined"}function isString(e){return typeof e=="string"}function isWindow(e){return e&&e.document&&e.location&&e.alert&&e.setInterval}function isDocument(e){return window.document===e}function isApp(e){return e===app}function canRun(){var e=!0,t={};if(!history||!history.pushState)e=!1,t.router="Browser Does not support History API";if(!window.URL.createObjectURL||typeof Worker=="undefined")e=!1,t.worker="Browser Does not support Webworkers";return e?!0:t}function log(){debug&&window.console&&console.log.apply(console,arguments)}function emit(e,t){log("jqMVC -> emit -> "+e),$(app).trigger(e,t)}function escapeRegExp(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}function jobPending(){for(var e in jobs)jobs[e].state!==3&&safelyStopJob(e,0)}function safelyStopJob(e,t){jobs[e].state!==1&&jobs[e].state!==2?(jobs[e].state=t,clearInterval(jobs[e].timer),t==-1&&delete jobs[e]):setTimeout(function(){safelyStopJob(e,t)},10)}function jobResume(e,t){var n=e===undefined||e!==undefined&&e==="*"?jobs:!1;n||(n={},jobs.hasOwnProperty(e)&&(n[e]=jobs[e]));for(var r in n)if(jobs[r].state==0||t!==undefined)jobs[r].state=1,jobs[r].timer=setInterval(function(){jobs[r].state!==2&&(jobs[r].state=2,jobs[r].payload.call(this),jobs[r].state=1)},jobs[r].interval)}function jobPause(e){if(e==="*")for(var t in jobs)safelyStopJob(t,3);else jobs.hasOwnProperty(e)&&safelyStopJob(e,3)}function jobDestroy(e){if(e=="*")for(var t in jobs)safelyStopJob(t,-1);else jobs.hasOwnProperty(e)&&safelyStopJob(e,-1)}function jobInspect(e){return e==="*"?jobs:jobs.hasOwnProperty(e)?jobs[e]:"job doesnt exist"}function timeParse(e){log("parsing time: "+e);if(typeof e=="string"){var t=e.match(/^(\d+)(MS|S|M|H|ms|s|m|h)$/);if(t.length==3){var n=parseInt(t[1]),r=t[2].toLowerCase(),i={ms:1,s:1e3,m:6e4,h:36e5};e=n*i[r]}else e=-1}return log("parsed time: "+e),e}function getController(e){var t=e.closest("[jq-ctrl]");return t.length>0?window.ctrl[t.jq("ctrl")]||!1:window.ctrl}function resolve(t,c){var d=getController(t);return d!==!1?d[t.jq(c)]:eval("window.ctrl."+t.jq(c))}function unbind(){log("jqMVC -> unbind");for(var e=0;e<destructors.length;e++)destructors[e].call(this);destructors.length=0;for(var e=0;e<jQbound.length;e++)$(jQbound[e]).find("*").addBack().off();jQbound.length=0}function bind(){log("jqMVC -> bind");for(var e in evt){var t=evt[e];typeof t=="function"&&t.apply(this)}for(var n=0;n<evtOnce.length;n++){var t=evtOnce[n];typeof t=="function"&&t.apply(this)}evtOnce.length=0}var app={},routeList=[],eventAdded=!1,currentUsedUrl=location.href,firstRoute=!0,firstRun=!1,router={},notify={alert:function(){},confirm:function(){}},progress={start:function(){},stop:function(){}},view={},model={},stack={},jQselector=$.fn.init,jQbound=[],evt={},evtOnce=[],jobs={},destructors=[],workers={};window.location.origin=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:""),window.ctrl={},window.svc={},window.models={},window.workers={},window.app_path="/",window.api_path="/api/",window.view_path="/views",window.module_path="/modules",window.element=$("body"),window.debug=!1,window.binding_override=!1,$.fn.init=function(e,t){var n=isDefined(e)&&!isApp(e)&&(isString(e)||isWindow(e)||isDocument(e))!==!1,r=new jQselector(e,t||window.document,$);return n&&(jQbound=app.merge(jQbound,[e])),r},$.fn.serializeObject=function(){"use strict";var e={},t=function(t,n){var r=e[n.name];"undefined"!=typeof r&&r!==null?$.isArray(r)?r.push(n.value):e[n.name]=[r,n.value]:e[n.name]=n.value};return $.each(this.serializeArray(),t),e},$.fn.jq=function(e,t){if(typeof e=="string"){if(typeof t=="undefined")return this.attr("jq-"+e);this.attr("jq-"+e,t)}return this},evt.bindDefaults=function(){eventAdded||(function(e){var t=function(e,t){var n=document.createEvent("CustomEvent");return n.initCustomEvent(t,!0,!0,e.target),e.target.dispatchEvent(n),n=null,!1},n=!0,r={x:0,y:0},i={x:0,y:0},s={touchstart:function(e){r={x:e.touches[0].pageX,y:e.touches[0].pageY}},touchmove:function(e){n=!1,i={x:e.touches[0].pageX,y:e.touches[0].pageY}},touchend:function(e){if(n)t(e,"fc");else{var s=i.x-r.x,o=Math.abs(s),u=i.y-r.y,a=Math.abs(u);Math.max(o,a)>20&&t(e,o>a?s<0?"swl":"swr":u<0?"swu":"swd")}n=!0},touchcancel:function(e){n=!1}};for(var o in s)e.addEventListener(o,s[o],!1)}(document),eventAdded=!0),$.each({swr:"swipe-right",swl:"swipe-left",swu:"swipe-up",swd:"swipe-down",fc:"fast-click"},function(e,t){$("[jq-"+t+"]").each(function(){$(this).on(e,resolve($(this),t))})}),$.each(["click","dblclick","mousedown","mouseup","keydown","keypress","keyup","change","scroll","dragstart","dragstop","error"],function(e,t){$("[jq-"+t+"]").each(function(){$(this).on(t,resolve($(this),t))})}),$("[jq-load]").each(function(e,t){resolve($(this),"load").apply(this)}),$("[jq-unload]").each(function(e,t){app.unload(resolve($(this),"unload"))}),$(document).on("submit","form[jq-method][jq-action][jq-callback]",function(e){function r(){t.el.find('button[type="submit"]').prop("disabled",!0),$.ajax({url:api_path+t.action,type:t.method.toUpperCase(),data:t.data,contentType:t.type,cache:!1,processData:t.processData,success:function(e){e=JSON.parse(e),n[t.cb].call(t.el,e)},error:function(e,r,i){n[t.cb].call(t.el,{error:1,message:e.status+" "+e.responseText})}}).always(function(){t.el.find('button[type="submit"]').prop("disabled",!1)})}e.preventDefault();var t={};t.el=$(this),t.method=t.el.jq("method"),t.action=t.el.jq("action"),t.bf=t.el.jq("before"),t.cb=t.el.jq("callback"),t.isFile=!!t.el.find(':input[type="file"]').length;var n=getController(t.el);return t.isFile?(t.data=new FormData(this),t.type=!1,t.processData=!1):(t.data=t.el.serializeObject(),t.type="application/x-www-form-urlencoded; charset=UTF-8",t.processData=!0),typeof t.bf!="undefined"?(new Promise(function(e,r){n[t.bf](t,e,r)})).then(function(){r()},function(){}):r(),!1}),$(document).on("click","[jq-href]",function(e){return e.preventDefault(),emit("before.go"),app.go($(this).jq("href"),"Loading"),!1}),$(window).bind("popstate",router.popstate),function(){var e=[];$("[jq-resize]").each(function(t,n){e.push(resolve($(this),$(this).jq("resize")))}),$(window).resize(function(){$.each(e,function(e,t){t.apply(window)})})}()},stack.items=[],stack.next=function(){log("jqMVC -> middleware -> next()"),stack.items.shift().call($,stack)},router.normalize=function(e,t){return app_path!=="/"&&e.indexOf(app_path)!==0&&(e=(app_path+e).trim("/")),e=e.replace(new RegExp(window.location.origin,"g"),"").replace(/\/+/g,"/").trim("/"),typeof t=="undefined"&&(e=e.split("?")[0]),e.length||(e="/"),log("jqMVC -> router -> normalize :: "+e),e},router.go=function(e){e=router.normalize(e,!0),history.pushState({},null,e),router.checkRoutes()},router.currentId="",router.currentParameters={},router.params=function(e){var t=router.normalize(e),n=router.params(t);return n.length==0?router.currentParameters={}:router.currentParameters=n[0].data,router.currentParameters},router.checkRoutes=function(){var e=router.normalize(location.href),t=router.params(e),n=t.slice();log("jqMVC -> router -> checkRoutes :: found "+n.length+" routes",n),router.tryRoutes(n)},router.tryRoutes=function(e){if(e.length===0)emit("notFound");else{var t=e.shift(),n=e.slice(),r=window.onerror;window.onerror=function(e){e=e.replace("uncaught exception:","").trim();switch(e){case"accept":log("jqMVC -> router -> accept");break;case"pass":log("jqMVC -> router -> pass"),router.tryRoutes(n);break;case"halt":log("jqMVC -> router -> halt");break;default:log("jqMVC -> router -> uncaught exception: "+e)}return window.onerror=r,!0};var i=[];for(var s in t.data)i.push(t.data[s]);var o={items:t.middleware.slice(),next:function(){o.items.length>0?(log("jqMVC -> router -> route -> mw -> next"),o.items.shift().call(this,o)):(log("jqMVC -> router -> route -> callback"),t.callback.apply(this,i))}};o.next()}return},router.params=function(e){var t=[];for(var n=0;n<routeList.length;n++){var r=routeList[n];if(r.type=="regexp"){var i=e.match(r.route);if(i){var s=function(){return r}();s.data={matches:i},t.push(s)}}else{var o=e.split("/"),u=r.route.split("/");if(u.length==o.length){var a={},f=!0,l=0;for(var c=0;c<u.length;c++)u[c].indexOf(":")===0?(a[u[c].substring(1)]=decodeURI(o[c]),l++):u[c]==o[c]&&l++;if(u.length==l){var s=function(){return r}();s.data=a,t.push(s),router.currentParameters=a}}}}return t},router.popstate=function(e){e!==null&&e.originalEvent&&e.originalEvent.state!==undefined&&(log("jqMVC -> router -> popstate"),router.checkRoutes())},typeof Worker!="undefined"&&(Worker.createURL=function(e){var t=typeof e=="function"?e.toString():e,n=new Blob(["'use strict';\nself.onmessage ="+t],{type:"text/javascript"});return window.URL.createObjectURL(n)},Worker.create=function(e){return new Worker(Worker.createURL(e))}),app.add=function(e){return stack.items.push(e),app},app.alert=function(){return notify.alert.apply(this,arguments),app},app.before=function(){return progress.start(),app},app.bind=function(e,t){if(binding_override||!evt.hasOwnProperty(e))evt[e]=t;return app},app.bindOnce=function(e){return evtOnce.push(e),app},app.debug=function(){return{routes:routeList,bindings:evt,controllers:ctrl,services:svc,models:models,jobs:jobs}},app.callableResolver=function(c){return function(){var args=arguments;return eval(c+".apply(this,args)")}},app.confirm=function(){return notify.confirm.apply(this,arguments),app},app.ctrl=function(e,t){return ctrl[e]=t,app},app.data=function(e){for(var t in e)window[t]=e[t];return app},app.done=function(){throw progress.stop(),unbind(),bind(),jobResume(),emit("on.done"),"accept"},app.go=function(e){return jobPending(),router.go(e),app},app.group=function(e,t,n){typeof t=="function"&&typeof n=="undefined"&&(n=t,t=null);if(typeof e!="string")throw"prefix must be a string";var r=app.route;return app.route=function(){var n=[];Array.prototype.push.apply(n,arguments);var i=n.shift();if(i instanceof RegExp){i=i.toString().substr(1);var s="";i.substr(-1)!=="/"?(i=i.split("/"),s=i.pop(),i=i.join("/")):i=i.substr(0,i.length-1),i=escapeRegExp(e)+i,i=new RegExp(i,s)}else i=e+i;var o=n.pop(),u=n;t!==null&&(u=app.merge([t],u));var a=app.merge([i],u,[o]);return r.apply(this,a),app},n.apply(this),app.route=r,app},app.halt=function(e){throw log("jqMVC -> router -> route -> mw -> reject"),typeof e=="function"&&e.apply(this),"halt"},app.loadModules=function(e){return e.length>0&&app.add(function(t){function n(e){var t=document.createElement("script");t.src=e,t.addEventListener("load",function(){r++,$(i).trigger("check")},!1),t.addEventListener("error",function(){r++,$(i).trigger("check")},!1),document.body.appendChild(t)}var r=0,i={};for(var s=0;s<e.length;s++)n(app.path+module_path+e[s]);$(i).on("check",function(){r>=e.length&&t.next()})}),app},app.loadOnce=function(e,t,n){var r=app.path+module_path+e;$('script[src="'+r+'"][jq-loadonce]').length&&$('script[src="'+r+'"][jq-loadonce]').remove();var i=document.createElement("script");return i.src=r,i.setAttribute("jq-loadonce","1"),i.addEventListener("load",function(){if(typeof t!="function")throw"loadOnce - callback is undefined";t.apply(this)},!1),i.addEventListener("error",function(){if(typeof n!="function")throw"loadOnce - failed to load resource";n.apply(this)},!1),document.body.appendChild(i),app},app.job=function(){switch(arguments.length){case 3:jobs[arguments[0]]={state:0,payload:arguments[1],interval:timeParse(arguments[2]),timer:null};break;case 2:switch(arguments[0]){case"pause":jobPause(arguments[1]);break;case"destroy":jobDestroy(arguments[1]);break;case"resume":jobResume(arguments[1],!0);break;case"inspect":return jobInspect(arguments[1])}}return app},app.listen=function(e,t){return $(app).bind(e,t),app},app.listenOnce=function(e,t){return $(app).off(e,t),$(app).one(e,t),app},app.merge=function(){var e=[],t=[],n=function(e,t){e=e.concat(t);for(var n=0;n<e.length;++n)for(var r=n+1;r<e.length;++r)e[n]===e[r]&&e.splice(r--,1);return e};Array.prototype.push.apply(e,arguments);for(var r=0;r<e.length;r++)t=n(t,e[r]);return t},app.model=function(e,t){return model[e]=t,app},app.pass=function(){throw"pass"},Object.defineProperty(app,"path",{get:function(){var e=new RegExp(window.location.origin),t=app_path.replace(e,"").replace(/\/+/g,"/").trim("/");return t.length?t:"/"}}),app.query=function(){var e=(window.location.search||"?").substr(1);return e.length?e.trim().split("&").reduce(function(e,t){var n=t.replace(/\+/g," ").split("=");return e[n[0]]=n[1]===undefined?null:decodeURIComponent(n[1]),e},{}):{}},app.run=function(){var e=canRun();e!==!0&&emit("app.incompatible",e),app.add(function(){router.go(location.href)}),stack.next(),app.run=function(){}},app.route=function(){var e=[];Array.prototype.push.apply(e,arguments);var t=e.shift(),n=e.pop(),r=e,i=typeof t=="object";return i||(t=router.normalize(t)),routeList.push({route:t,middleware:r,callback:n,type:i?"regexp":"string"}),app},app.setModel=function(e){return model=e,app},app.setNotification=function(e){return notify=e,app},app.setProgress=function(e){return progress=e,app},app.setView=function(e){return view=e,app},app.svc=function(e,t){return svc[e]=t,app},app.trigger=function(e,t){return emit(e,t),app},app.unload=function(e){return destructors.push(e),app},Object.defineProperty(app,"view",{get:function(){return view}}),app.worker=function(e,t){return workers[e]=Worker.create(t),app},Object.defineProperty(app,"workers",{get:function(){return workers}}),$.jqMVC=app}(jQuery,window,document)