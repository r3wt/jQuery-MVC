/**
 * jqMVC - The jQuery MVC Framework
 *
 * @version   0.4.2
 * @link      https://github.com/r3wt/jqMVC
 * @copyright (c) 2015 Garrett R. Morris
 * @license   https://github.com/r3wt/jqMVC/blob/master/LICENSE (MIT License)
 * @build     2016-01-28_09:42:49 UTC
 */
!function($,window,document){function isDefined(e){return typeof e!="undefined"}function isString(e){return typeof e=="string"}function isWindow(e){return e&&e.document&&e.location&&e.alert&&e.setInterval}function isDocument(e){return window.document===e}function isApp(e){return e===app}function getPath(){var e=app_path.replace(window.location.origin,"").replace(/\/+/g,"/").trim("/");return e.length?e:"/"}function getQueryString(){var e=(window.location.search||"?").substr(1);return e.length?e.trim().split("&").reduce(function(e,t){var n=t.replace(/\+/g," ").split("=");return e[n[0]]=n[1]===undefined?null:decodeURIComponent(n[1]),e},{}):{}}function checkRoutes(){var e=parseUrl(location.pathname),t=getParameters(e),n=t.slice();log(n),tryRoutes(n)}function tryRoutes(e){if(e.length===0)emit("notFound");else{var t=e.shift(),n=e.slice(),r=window.onerror;window.onerror=function(e,t,n){return!0};function i(){window.onerror=r,log("jqMVC -> router -> accept")}try{var s=[];for(var o in t.data)s.push(t.data[o]);var u={items:t.middleware.slice(),next:function(){window.location.query=getQueryString(),u.items.length>0?(log("jqMVC -> router -> route -> mw -> next"),u.items.shift().call(this,u)):(log("jqMVC -> router -> route -> callback"),t.callback.apply(this,s))}};u.next(),$(router).off("accept",i),$(router).one("accept",i)}catch(a){var f=a.toString();switch(f){case"pass":tryRoutes(n);break;case"halt":break;default:throw a}window.onerror=r,log("jqMVC -> router -> "+f)}}return!1}function parseUrl(e){var t=e?e:location.pathname;t=decodeURI(t);if(!hasPushState){if(location.hash.indexOf("#!/")!==0)return"";t+=location.hash.substring(3)}return t.slice(-1)=="/"&&(t=t.substring(0,t.length-1)),t}function getParameters(e){var t=[];for(var n=0;n<routeList.length;n++){var r=routeList[n];if(r.type=="regexp"){var i=e.match(r.route);if(i){var s=function(){return r}();s.data={matches:i},t.push(s)}}else{var o=e.split("/"),u=r.route.split("/");if(u.length==o.length){var a={},f=!0,l=0;for(var c=0;c<u.length;c++)u[c].indexOf(":")===0?(a[u[c].substring(1)]=decodeURI(o[c]),l++):u[c]==o[c]&&l++;if(u.length==l){var s=function(){return r}();s.data=a,t.push(s),router.currentParameters=a}}}}return t}function handleRoutes(e){e!=null&&e.originalEvent&&e.originalEvent.state!==undefined?checkRoutes():hasHashState?checkRoutes():!hasHashState&&!hasPushState&&checkRoutes()}function log(){debug&&window.console&&console.log.apply(console,arguments)}function emit(e,t){log("jqMVC -> emit -> "+e),$(app).trigger(e,t)}function escapeRegExp(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}function jobPending(){for(var e in jobs)jobs[e].state!==3&&(jobs[e].state=0,clearInterval(jobs[e].timer))}function jobResume(e,t){switch(!0){case e===undefined:case e!==undefined&&e==="*":for(var n in jobs)if(jobs[n].state==0||t!==undefined)jobs[n].state=1,jobs[n].timer=interval(function(){jobs[n].state!==2&&(jobs[n].state=2,jobs[n].payload.call(this),jobs[n].state=1)},jobs[n].interval);break;default:var n=e;jobs.hasOwnProperty(n)&&(jobs[n].state==0||t!==undefined)&&(jobs[n].state=1,jobs[n].timer=interval(function(){jobs[n].state!==2&&(jobs[n].state=2,jobs[n].payload.call(),jobs[n].state!==3&&(jobs[n].state=1))},jobs[n].interval))}}function jobPause(e){if(e==="*")for(var t in jobs)jobs[t].state=3,clearInterval(jobs[t].timer);else jobs.hasOwnProperty(e)&&(jobs[e].state=3,clearInterval(jobs[e].timer))}function jobDestroy(e){if(e=="*")for(var t in jobs)clearInterval(jobs[t].timer),delete jobs[t];else jobs.hasOwnProperty(t)&&(clearInterval(jobs[t].timer),delete jobs[t])}function jobInspect(e){return e==="*"?jobs:jobs.hasOwnProperty(e)?jobs[e]:"job doesnt exist"}function timeParse(e){log("parsing time: "+e);if(typeof e=="string"){var t=e.match(/^(\d+)(MS|S|M|H|ms|s|m|h)$/);if(t.length==3){var n=parseInt(t[1]),r=t[2].toLowerCase(),i={ms:1,s:1e3,m:6e4,h:36e5};e=n*i[r]}else e=-1}return log("parsed time: "+e),e}function interval(e,t){return setInterval(e,t)}function unbindEvents(){log("jqMVC -> unbindEvents");for(var e=0;e<jQbound.length;e++)$(jQbound[e]).find("*").addBack().off();jQbound.length=0,clearInterval(router.interval)}function bindEvents(){log("jqMVC -> bindEvents");for(var e in evt){var t=evt[e];typeof t=="function"&&t.apply(this)}}function bindOneTimeEvents(){log("jqMVC -> bindOneTimeEvents");for(var e=0;e<evtOnce.length;e++){var t=evtOnce[e];typeof t=="function"&&t.apply(this)}evtOnce.length=0}var app={},hasPushState=history&&history.pushState,hasHashState=!hasPushState&&"onhashchange"in window&&!1,routeList=[],eventAdded=!1,currentUsedUrl=location.href,firstRoute=!0,firstRun=!1,router={},notify={alert:function(e){alert(e)},confirm:function(e,t){confirm(e)&&t.apply(this)}},progress={start:function(){},stop:function(){}},view={render:function(){throw app.done(),"You must implement a view library to use this feature."}},model={},stack={},jQselector=$.fn.init,jQbound=[],evt={},evtOnce=[],jobs={};window.location.origin=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:""),window.ctrl={},window.svc={},window.models={},window.app_path="/",window.api_path="/api/",window.view_path="/views",window.module_path="/modules",window.model_path="/models",window.element=$("body"),window.debug=!1,window.binding_override=!1,$.fn.serializeObject=function(){var e=this.serializeArray(),t={};for(var n=0;n<e.length;n++)t[e[n].name]=e[n].value;return t},$.fn.jq=function(e,t){if(typeof e=="string"){if(typeof t=="undefined")return this.attr("jq-"+e);this.attr("jq-"+e,t)}return this},$.fn.init=function(e,t){var n=isDefined(e)&&!isApp(e)&&(isString(e)||isWindow(e)||isDocument(e))!==!1,r=new jQselector(e,t||window.document,$);return n&&(jQbound=app.merge(jQbound,[e])),r},evt.bindRouter=function(){eventAdded=!0,router.fromHash=!1;if(hasPushState){if(location.hash.indexOf("#!/")===0){var e=location.pathname+location.hash.replace(/^#!\//gi,"");history.replaceState({},"",e),router.fromHash=!0}$(window).bind("popstate",handleRoutes)}else hasHashState?$(window).bind("hashchange.router",handleRoutes):router.interval=setInterval(function(){location.href!=currentUsedUrl&&(handleRoutes(),currentUsedUrl=location.href)},500)},evt.bindHref=function(){$(document).on("click","a[data-href]",function(e){return e.preventDefault(),emit("before.go"),app.go(getPath().replace(/\/+$/,"")+$(this).data("href"),"Loading"),!1})},evt.bindForm=function(){$(document).on("submit","form[method][ctrl][action][callback]",function(e){function n(){t.el.find('button[type="submit"]').prop("disabled",!0),$.ajax({url:api_path+t.action,type:t.method.toUpperCase(),data:t.data,contentType:t.type,cache:!1,processData:t.processData,success:function(e){var e=JSON.parse(e);window.ctrl[t.ctrl][t.cb].call(t.el,e)},error:function(e,n,r){window.ctrl[t.ctrl][t.cb].call(t.el,{error:1,message:e.status+" "+e.responseText})}}).always(function(){t.el.find('button[type="submit"]').prop("disabled",!1)})}e.preventDefault();var t={};return t.el=$(this),t.method=t.el.attr("method"),t.action=t.el.attr("action"),t.ctrl=t.el.attr("ctrl"),t.bf=t.el.attr("before"),t.cb=t.el.attr("callback"),t.isFile=!!t.el.find(':input[type="file"]').length,t.isFile?(t.data=new FormData(this),t.type=!1,t.processData=!1):(t.data=t.el.serializeObject(),t.type="application/x-www-form-urlencoded; charset=UTF-8",t.processData=!0),typeof t.bf=="function"?(new Promise(window.ctrl[t.ctrl][t.bf])).then(function(){n()},function(){}):n(),log(window,t),!1})},evt.bindModel=function(){},stack.items=[],stack.next=function(){log("jqMVC -> middleware -> next()"),stack.items.shift().call($,stack)},router.interval=null,router.currentId="",router.currentParameters={},router.capabilities={hash:hasHashState,pushState:hasPushState,timer:!hasHashState&&!hasPushState},router.checkRoute=function(e){return getParameters(parseUrl(e)).length>0},router.parameters=function(e){var t=parseUrl(e),n=getParameters(t);return n.length==0?router.currentParameters={}:router.currentParameters=n[0].data,router.currentParameters},app.add=function(e){return stack.items.push(e),app},app.alert=function(){return notify.alert.apply(this,arguments),app},app.before=function(){return progress.start(),app},app.bind=function(e,t){if(binding_override||!evt.hasOwnProperty(e))evt[e]=t;return app},app.bindOnce=function(e){return evtOnce.push(e),app},app.debug=function(){return{routes:routeList,bindings:evt,controllers:ctrl,services:svc,models:models,jobs:jobs}},app.callableResolver=function(c){return function(){var args=arguments;return eval(c+".apply(this,args)")}},app.checkCompatibility=function(){try{var e=$.fn.jquery.split("."),t=[];for(var n=0;n<e.length;n++)t.push(parseInt(e[n]));switch(!0){case t[0]<2:case t[1]<1:case t[2]<3:throw"jqMVC requires jQuery 2.1.3 or greater. Upgrade dummy!"}log("using jQuery version "+t.join("."))}catch(r){emit("incompatible",{reason:r})}return app},app.confirm=function(){return notify.confirm.apply(this,arguments),app},app.ctrl=function(e,t){return ctrl[e]=t,app},app.data=function(e){for(var t in e)window[t]=e[t];return app},app.done=function(e){return emit("on.done"),progress.stop(),unbindEvents(),bindEvents(),bindOneTimeEvents(),typeof e=="function"&&e.apply(this),$(router).trigger("accept"),jobResume(),!1},app.go=function(e){jobPending();if(hasPushState)history.pushState({},null,e),checkRoutes(),eventAdded||evt.bindRouter();else{eventAdded||evt.bindRouter(),e=e.replace(location.protocol+"//","").replace(location.hostname,"");var t=e.replace(location.pathname,"");t.indexOf("!")<0&&(t="!/"+t),location.hash=t}return app},app.group=function(e,t,n){if(typeof t=="function"&&typeof n=="undefined"){var n=t;t=null}if(typeof e!="string")throw"prefix must be a string";var r=app.route;return app.route=function(){var n=[];Array.prototype.push.apply(n,arguments);var i=n.shift();if(i instanceof RegExp){i=i.toString().substr(1);var s="";i.substr(-1)!=="/"?(i=i.split("/"),s=i.pop(),i=i.join("/")):i=i.substr(0,i.length-1),i=escapeRegExp(e)+i,i=new RegExp(i,s)}else i=e+i;var o=n.pop(),u=n;t!==null&&(u=app.merge([t],u));var a=app.merge([i],u,[o]);return r.apply(this,a),app},n.apply(this),app.route=r,app},app.halt=function(e){throw log("jqMVC -> router -> route -> mw -> reject"),typeof e=="function"&&e.apply(this),"halt"},app.loadModules=function(e){return e.length>0&&app.add(function(t){function n(e){var t=document.createElement("script");t.src=e,t.addEventListener("load",function(){r++,$(i).trigger("check")},!1),t.addEventListener("error",function(){r++,$(i).trigger("check")},!1),document.body.appendChild(t)}var r=0,i={};for(var s=0;s<e.length;s++)n(getPath()+module_path+e[s]);$(i).on("check",function(){r>=e.length&&t.next()})}),app},app.loadOnce=function(e,t,n){var r=getPath()+module_path+e;$('script[src="'+r+'"][jq-loadonce]').length&&$('script[src="'+r+'"][jq-loadonce]').remove();var i=document.createElement("script");return i.src=r,i.setAttribute("jq-loadonce","1"),i.addEventListener("load",function(){throw typeof t=="function"&&t.apply(this),"loadOnce - callback is undefined"},!1),i.addEventListener("error",function(){if(typeof n!="function")throw"loadOnce - failed to load resource";n.apply(this)},!1),document.body.appendChild(i),app},app.job=function(){switch(arguments.length){case 3:jobs[arguments[0]]={state:0,payload:arguments[1],interval:timeParse(arguments[2]),timer:null};break;case 2:switch(arguments[0]){case"pause":jobPause(arguments[1]);break;case"destroy":jobDestroy(arguments[1]);break;case"resume":jobResume(arguments[1],!0);break;case"inspect":return jobInspect(arguments[1])}}return app},app.listen=function(e,t){return $(app).bind(e,t),app},app.listenOnce=function(e,t){return $(app).off(e,t),$(app).one(e,t),app},app.merge=function(){var e=[],t=[],n=function(e,t){var e=e.concat(t);for(var n=0;n<e.length;++n)for(var r=n+1;r<e.length;++r)e[n]===e[r]&&e.splice(r--,1);return e};Array.prototype.push.apply(e,arguments);for(k=0;k<e.length;k++)t=n(t,e[k]);return t},app.model=function(e,t){return model[e]=t,app},app.pass=function(){throw"pass"},app.render=function(){return view.render.apply(this,arguments),app},app.run=function(){app.add(function(){app.go(location.href)}),stack.next(),app.run=function(){}},app.route=function(){var e=[];Array.prototype.push.apply(e,arguments);var t=e.shift(),n=e.pop(),r=e,i=typeof t=="object";return i||(t=getPath().replace(/\/+$/,"")+t,t.lastIndexOf("/")==t.length-1&&(t=t.substring(0,t.length-1)),t=t.replace(location.protocol+"//","").replace(location.hostname,"")),routeList.push({route:t,middleware:r,callback:n,type:i?"regexp":"string"}),app},app.setModel=function(e){return model=e,app},app.setNotification=function(e){return notify=e,app},app.setProgress=function(e){return progress=e,app},app.setView=function(e){return view=e,app},Object.defineProperty(app,"view",{get:function(){return view}}),app.svc=function(e,t){return svc[e]=t,app},app.trigger=function(e,t){return emit(e,t),app},app.unload=function(e){},$.jqMVC=app}(jQuery,window,document)