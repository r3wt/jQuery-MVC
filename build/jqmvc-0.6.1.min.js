/**
 * jqMVC - The jQuery MVC Framework
 *
 * @version   0.6.1
 * @link      https://github.com/r3wt/jqMVC
 * @copyright (c) 2015 - 2016 Garrett R. Morris
 * @license   https://github.com/r3wt/jqMVC/blob/master/LICENSE (MIT License)
 * @build     2016-05-04_19:39:19 UTC
 * contains 3rd party code:
 * jQuery.serializeObject() - Copyright (c) 2013 David Hong - https://github.com/hongymagic/jQuery.serializeObject
 * touch events by cocco - http://stackoverflow.com/a/17567696/2401804
 */
!function($,window,document){function isDefined(e){return void 0!==e}function isString(e){return"string"==typeof e}function isWindow(e){return e&&e.document&&e.location&&e.alert&&e.setInterval}function isDocument(e){return window.document===e}function isApp(e){return e===app}function canRun(){var e=!0,t={};return history&&history.pushState||(e=!1,t.router="Browser Does not support History API"),window.URL.createObjectURL&&"undefined"!=typeof Worker||(e=!1,t.worker="Browser Does not support Webworkers"),e?!0:t}function log(){debug&&window.console&&console.log.apply(console,arguments)}function emit(e,t){log("jqMVC -> emit -> "+e),$(app).trigger(e,t)}function escapeRegExp(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}function jobPending(){for(var e in jobs)safelyStopJob(e,0)}function safelyStopJob(e,t){3!==jobs[e].state&&(jobs[e].state=t),clearInterval(jobs[e].timer),-1==t&&delete jobs[e]}function jobResume(e,t){var o,r,n=void 0===e||void 0!==e&&"*"===e?jobs:!1;n||(n={},jobs.hasOwnProperty(e)&&(n[e]=jobs[e]));for(o in n)3===jobs[o].state&&"*"!=e||(safelyStopJob(o,0),r=jobs[o],r.state=1,r.timer=setInterval(r.payload,r.interval))}function jobPause(e){if("*"===e)for(var t in jobs)safelyStopJob(t,3);else jobs.hasOwnProperty(e)&&safelyStopJob(e,3)}function jobDestroy(e){if("*"==e)for(var t in jobs)safelyStopJob(t,-1);else jobs.hasOwnProperty(e)&&safelyStopJob(e,-1)}function jobInspect(e){return"*"===e?jobs:jobs.hasOwnProperty(e)?jobs[e]:"job doesnt exist"}function timeParse(e){var t,n,o,r;return"string"==typeof e&&(t=e.match(/^(\d+)(MS|S|M|H|ms|s|m|h)$/),3==t.length?(n=parseInt(t[1]),o=t[2].toLowerCase(),r={ms:1,s:1e3,m:6e4,h:36e5},e=n*r[o]):e=-1),e}function xssFilter(e){var t=decodeURIComponent(e).replace(/<script([^'"]|"(\\.|[^"\\])*"|'(\\.|[^'\\])*')*?<\/script>/g,"").split(""),n=[],o=0,r=0;for(i=0;i<t.length;i++)switch(t[i]+o+r){case"<00":o=1;break;case">10":o=0,n.push(" ");break;case'"10':r=1;break;case"'10":r=2;break;case'"11':case"'12":r=0;break;default:o||n.push(t[i])}return n.join("")}function loadScript(e,t,n,o){var r=document.createElement("script");r.src=e,r.addEventListener("load",t,!1),r.addEventListener("error",n,!1),"function"==typeof o&&o(r),document.body.appendChild(r)}function getController(e){var t=e.closest("[jq-ctrl]");return t.length>0?window.ctrl[t.jq("ctrl")]||!1:window.ctrl}function resolve(t,c){var d=getController(t);return d!==!1?d[t.jq(c)]:eval("window.ctrl."+t.jq(c))}function unbind(){var e;for(log("jqMVC -> unbind"),e=0;e<destructors.length;e++)destructors[e].call(this);for(destructors.length=0,e=0;e<jQbound.length;e++)$(jQbound[e]).find("*").addBack().off();jQbound.length=0}function bind(){var e,t,n;log("jqMVC -> bind");for(e in evt)t=evt[e],"function"==typeof t&&t.apply(this);for(n=0;n<evtOnce.length;n++)t=evtOnce[n],"function"==typeof t&&t.apply(this);evtOnce.length=0}var app={},routeList=[],eventAdded=!1,currentUsedUrl=location.href,firstRoute=!0,firstRun=!1,router={},notify={alert:function(){},confirm:function(){}},progress={start:function(){},stop:function(){}},view={},model={},stack={},jQselector=$.fn.init,jQbound=[],evt={},evtOnce=[],jobs={},destructors=[],workers={};window.location.origin=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:""),window.ctrl={},window.svc={},window.models={},window.workers={},window.app_path="/",window.api_path="/api/",window.view_path="/views",window.module_path="/modules",window.element=$("body"),window.debug=!1,window.binding_override=!1,$.fn.init=function(e,t){var n=isDefined(e)&&!isApp(e)&&(isString(e)||isWindow(e)||isDocument(e))!==!1,o=new jQselector(e,t||window.document,$);return n&&(jQbound=app.merge(jQbound,[e])),o},$.fn.serializeObject=function(){"use strict";var e={},t=function(t,n){var o=e[n.name];void 0!==o&&null!==o?$.isArray(o)?o.push(n.value):e[n.name]=[o,n.value]:e[n.name]=n.value};return $.each(this.serializeArray(),t),e},$.fn.jq=function(e,t){if("string"==typeof e){if(void 0===t)return this.attr("jq-"+e);this.attr("jq-"+e,t)}return this},evt.bindDefaults=function(){eventAdded||(!function(e){var a,t=function(e,t){var n=document.createEvent("CustomEvent");return n.initCustomEvent(t,!0,!0,e.target),e.target.dispatchEvent(n),n=null,!1},n=!0,o={x:0,y:0},r={x:0,y:0},i={touchstart:function(e){o={x:e.touches[0].pageX,y:e.touches[0].pageY}},touchmove:function(e){n=!1,r={x:e.touches[0].pageX,y:e.touches[0].pageY}},touchend:function(e){if(n)t(e,"fc");else{var i=r.x-o.x,a=Math.abs(i),p=r.y-o.y,s=Math.abs(p);Math.max(a,s)>20&&t(e,a>s?0>i?"swl":"swr":0>p?"swu":"swd")}n=!0},touchcancel:function(e){n=!1}};for(a in i)e.addEventListener(a,i[a],!1)}(document),eventAdded=!0),$.each({swr:"swipe-right",swl:"swipe-left",swu:"swipe-up",swd:"swipe-down",fc:"fast-click"},function(e,t){$("[jq-"+t+"]").each(function(){$(this).on(e,resolve($(this),t))})}),$.each(["click","dblclick","mousedown","mouseup","keydown","keypress","keyup","change","scroll","dragstart","dragstop","error"],function(e,t){$("[jq-"+t+"]").each(function(){$(this).on(t,resolve($(this),t))})}),$("[jq-load]").each(function(e,t){resolve($(this),"load").apply(this)}),$("[jq-unload]").each(function(e,t){app.unload(resolve($(this),"unload"))}),$(document).on("submit","form[jq-method][jq-action][jq-callback]",function(e){function o(){t.el.find('button[type="submit"]').prop("disabled",!0),$.ajax({url:api_path+t.action,type:t.method.toUpperCase(),data:t.data,contentType:t.type,cache:!1,processData:t.processData,success:function(e){e=JSON.parse(e),n[t.cb].call(t.el,e)},error:function(e,o,r){n[t.cb].call(t.el,{error:1,message:e.status+" "+e.responseText})}}).always(function(){t.el.find('button[type="submit"]').prop("disabled",!1)})}var t,n;return e.preventDefault(),t={},t.el=$(this),t.method=t.el.jq("method"),t.action=t.el.jq("action"),t.bf=t.el.jq("before"),t.cb=t.el.jq("callback"),t.isFile=!!t.el.find(':input[type="file"]').length,n=getController(t.el),t.isFile?(t.data=new FormData(this),t.type=!1,t.processData=!1):(t.data=t.el.serializeObject(),t.type="application/x-www-form-urlencoded; charset=UTF-8",t.processData=!0),void 0!==t.bf?new Promise(function(e,o){n[t.bf](t,e,o)}).then(function(){o()},function(){}):o(),!1}),$(document).on("click","[jq-href]",function(e){return e.preventDefault(),emit("before.go"),app.go($(this).jq("href"),"Loading"),!1}),$(window).bind("popstate",router.popstate),function(){var e=[];$("[jq-resize]").each(function(t,n){var o=resolve($(this),"resize");e.push(o),log(e.length),log(o)}),$(window).resize(function(){$.each(e,function(e,t){t.apply(window)})})}()},stack.items=[],stack.next=function(){log("jqMVC -> middleware -> next()"),stack.items.shift().call($,stack)},router.normalize=function(e,t){return"/"!==app_path&&0!==e.indexOf(app_path)&&(e=(app_path+e).trim("/")),e=e.replace(RegExp(window.location.origin,"g"),"").replace(/\/+/g,"/").trim("/"),void 0===t&&(e=e.split("?")[0]),e.length||(e="/"),log("jqMVC -> router -> normalize :: "+e),e},router.go=function(e){e=router.normalize(e,!0),history.pushState({},null,e),router.checkRoutes()},router.checkRoutes=function(){var e=router.normalize(location.href),t=router.params(e),n=t.slice();log("jqMVC -> router -> checkRoutes :: found "+n.length+" routes",n),router.tryRoutes(n)},router.tryRoutes=function(e){var t,n,o,r,i,a;if(0===e.length)emit("notFound");else{t=e.shift(),n=e.slice(),o=window.onerror,window.onerror=function(e){switch(e=e.replace("uncaught exception:","").trim()){case"accept":log("jqMVC -> router -> accept");break;case"pass":log("jqMVC -> router -> pass"),router.tryRoutes(n);break;case"halt":log("jqMVC -> router -> halt");break;default:log("jqMVC -> router -> uncaught exception: "+e)}return window.onerror=o,!0},r=[];for(i in t.data)r.push(t.data[i]);a={items:t.middleware.slice(),next:function(){a.items.length>0?(log("jqMVC -> router -> route -> mw -> next"),a.items.shift().call(this,a)):(log("jqMVC -> router -> route -> callback"),t.callback.apply(this,r))}},a.next()}},router.params=function(e){var n,o,r,i,a,p,s,u,c,t=[];for(n=0;n<routeList.length;n++)if(o=routeList[n],"regexp"==o.type)r=e.match(o.route),r&&(i=function(){return o}(),i.data={matches:r},t.push(i));else if(a=e.split("/"),p=o.route.split("/"),p.length==a.length){for(s={},u=0,c=0;c<p.length;c++)0===p[c].indexOf(":")?(s[p[c].substring(1)]=xssFilter(a[c]),u++):p[c]==a[c]&&u++;p.length==u&&(i=function(){return o}(),i.data=s,t.push(i))}return t},router.popstate=function(e){null!==e&&e.originalEvent&&void 0!==e.originalEvent.state&&(log("jqMVC -> router -> popstate"),router.checkRoutes())},"undefined"!=typeof Worker&&(Worker.createURL=function(e){var t="function"==typeof e?""+e:e,n=new Blob(["'use strict';\nself.onmessage ="+t],{type:"text/javascript"});return window.URL.createObjectURL(n)},Worker.create=function(e){return new Worker(Worker.createURL(e))}),app.add=function(e){return stack.items.push(e),app},app.alert=function(){return notify.alert.apply(this,arguments),app},app.before=function(){return progress.start(),app},app.bind=function(e,t){return!binding_override&&evt.hasOwnProperty(e)||(evt[e]=t),app},app.bindOnce=function(e){return evtOnce.push(e),app},app.debug=function(){return{routes:routeList,bindings:evt,controllers:ctrl,services:svc,models:models,jobs:jobs}},app.callableResolver=function(c){return function(){var args=arguments;return eval(c+".apply(this,args)")}},app.confirm=function(){return notify.confirm.apply(this,arguments),app},app.ctrl=function(e,t){return ctrl[e]=t,app},app.data=function(e){for(var t in e)window[t]=e[t];return app},app.done=function(){throw progress.stop(),unbind(),bind(),jobResume(),emit("on.done"),"accept"},app.go=function(e){return jobPending(),router.go(e),app},app.group=function(e,t,n){if("function"==typeof t&&void 0===n&&(n=t,t=null),"string"!=typeof e)throw"prefix must be a string";var o=app.route;return app.route=function(){var r,i,a,p,s,n=[];return Array.prototype.push.apply(n,arguments),r=n.shift(),r instanceof RegExp?(r=(""+r).substr(1),i="","/"!==r.substr(-1)?(r=r.split("/"),i=r.pop(),r=r.join("/")):r=r.substr(0,r.length-1),r=escapeRegExp(e)+r,r=RegExp(r,i)):r=e+r,a=n.pop(),p=n,null!==t&&(p=app.merge([t],p)),s=app.merge([r],p,[a]),o.apply(this,s),app},n.apply(this),app.route=o,app},app.halt=function(e){throw log("jqMVC -> router -> route -> mw -> reject"),"function"==typeof e&&e.apply(this),"halt"},app.loadModules=function(e){return e.length>0&&app.add(function(t){var r,n=0,o=function(){n+=1,n==e.length&&t.next()};for(r=0;r<e.length;r++)loadScript(app.path+module_path+e[r],o,o)}),app},app.loadOnce=function(e,t,n){return $('script[src="'+file+'"][jq-loadonce]').length&&$('script[src="'+file+'"][jq-loadonce]').remove(),loadScript(app.path+module_path+e,t,n,function(e){e.setAttribute("jq-loadonce","1")}),app},app.job=function(){switch(arguments.length){case 3:jobs[arguments[0]]={state:0,payload:arguments[1],interval:timeParse(arguments[2]),timer:null};break;case 2:switch(arguments[0]){case"pause":jobPause(arguments[1]);break;case"destroy":jobDestroy(arguments[1]);break;case"resume":jobResume(arguments[1],!0);break;case"inspect":return jobInspect(arguments[1])}}return app},app.listen=function(e,t){return $(app).bind(e,t),app},app.listenOnce=function(e,t){return $(app).off(e,t),$(app).one(e,t),app},app.merge=function(){var o,e=[],t=[],n=function(e,t){var n,o;for(e=e.concat(t),n=0;n<e.length;++n)for(o=n+1;o<e.length;++o)e[n]===e[o]&&e.splice(o--,1);return e};for(Array.prototype.push.apply(e,arguments),o=0;o<e.length;o++)t=n(t,e[o]);return t},app.model=function(e,t){return model[e]=t,app},app.pass=function(){throw"pass"},Object.defineProperty(app,"path",{get:function(){var e=RegExp(window.location.origin),t=app_path.replace(e,"").replace(/\/+/g,"/").trim("/");return t.length?t:"/"}}),app.query=function(){var e=(window.location.search||"?").substr(1);return e.length?e.trim().split("&").reduce(function(e,t){var n=t.replace(/\+/g," ").split("=");return e[n[0]]=void 0===n[1]?null:xssFilter(n[1]),e},{}):{}},app.run=function(){var e=canRun();e!==!0&&emit("app.incompatible",e),app.add(function(){router.go(location.href)}),stack.next(),app.run=function(){}},app.route=function(){var t,n,o,r,e=[];return Array.prototype.push.apply(e,arguments),t=e.shift(),n=e.pop(),o=e,r="object"==typeof t,r||(t=router.normalize(t)),routeList.push({route:t,middleware:o,callback:n,type:r?"regexp":"string"}),app},app.setModel=function(e){return model=e,app},app.setNotification=function(e){return notify=e,app},app.setProgress=function(e){return progress=e,app},app.setView=function(e){return view=e,app},app.svc=function(e,t){return svc[e]=t,app},app.trigger=function(e,t){return emit(e,t),app},app.unload=function(e){return destructors.push(e),app},Object.defineProperty(app,"view",{get:function(){return view}}),app.worker=function(e,t){return workers[e]=Worker.create(t),app},Object.defineProperty(app,"workers",{get:function(){return workers}}),$.jqMVC=app}(jQuery,window,document);